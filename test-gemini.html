<!doctype html>
<button id="go">Run Gemini Nano</button>
<pre id="log"></pre>
<script>
const log = (m)=>{document.getElementById('log').textContent += m + "\n";};

document.getElementById('go').addEventListener('click', async () => {
  try {
    if (!('LanguageModel' in window)) {
      log("LanguageModel API not exposed. Check flags and version.");
      return;
    }

    let avail = await LanguageModel.availability();
    log("availability: " + avail);

    // If it's downloadable, calling create() during a user gesture
    // is what actually starts the download.
    if (avail === "downloadable") {
      log("Starting download via create() â€¦ (keep this tab open)");
      try {
        await LanguageModel.create(); // may resolve only when ready on some builds
        avail = "available";
      } catch (e) {
        // Many builds throw while background download proceeds; that's OK.
        log("create() returned/errored while downloading: " + (e && e.name || e));
      }
    }

    // Poll until 'available'
    const waitUntilAvailable = async () => {
      for (;;) {
        const a = await LanguageModel.availability();
        log("availability: " + a);
        if (a === "available") return;
        await new Promise(r => setTimeout(r, 3000)); // 3s
      }
    };

    if (avail !== "available") {
      await waitUntilAvailable();
    }

    // Now it's ready: run a prompt
    const session = await LanguageModel.create();
    const out = await session.prompt("One sentence: what is a room impulse response?");
    log("reply: " + out);
  } catch (e) {
    log("Error: " + (e && (e.stack || e.message) || e));
  }
});
</script>
